<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png?v=7.4.1">
  <link rel="mask-icon" href="/images/avatar.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Mr.RS">
<meta property="og:url" content="https://mrrs878.github.io/page/2/index.html">
<meta property="og:site_name" content="Mr.RS">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mr.RS">
  <link rel="canonical" href="https://mrrs878.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Mr.RS</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mr.RS</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Read The Fucking Source Code!</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      
    
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/12/03/Java-IO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/12/03/Java-IO/" class="post-title-link" itemprop="url">Java-IO</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-12-03 21:03:45" itemprop="dateCreated datePublished" datetime="2018-12-03T21:03:45+08:00">2018-12-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-16 19:58:22" itemprop="dateModified" datetime="2019-10-16T19:58:22+08:00">2019-10-16</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java-流"><a href="#Java-流" class="headerlink" title="Java-流"></a>Java-流</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a><strong>概念</strong></h2><p>流：程序与文件|数组|网络连接|数据库等进行交互的通道，以程序为中心</p>
<h3 id="IO-流分类"><a href="#IO-流分类" class="headerlink" title="IO 流分类"></a><strong>IO 流分类</strong></h3><h4 id="流向"><a href="#流向" class="headerlink" title="流向"></a><strong>流向</strong></h4><ul>
<li>输入流</li>
<li>输出流</li>
</ul>
<h4 id="数据"><a href="#数据" class="headerlink" title="数据"></a><strong>数据</strong></h4><ul>
<li>字节流—-二进制，可以包含一切文件</li>
<li>字符流—-文本文件，只能处理纯文本</li>
</ul>
<h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a><strong>功能</strong></h4><ul>
<li>节点流—-包裹源头</li>
<li>处理流—-增强功能，提高性能</li>
</ul>
<h3 id="字符流与字节流"><a href="#字符流与字节流" class="headerlink" title="字符流与字节流"></a><strong>字符流与字节流</strong></h3><h4 id="字节流"><a href="#字节流" class="headerlink" title="字节流"></a><strong>字节流</strong></h4><ul>
<li>输入流：InputStream/FileInputStream</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="keyword">byte</span>[] b);</span><br><span class="line"> 	read(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len);</span><br><span class="line"> 	close();</span><br></pre></td></tr></table></figure>

<ul>
<li>输出流：OutputStream/FileOutputStream</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">write(<span class="keyword">byte</span>[] b);</span><br><span class="line"> 	write(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> off, <span class="keyword">int</span> len);</span><br><span class="line"> 	flush();</span><br><span class="line"> 	close();</span><br></pre></td></tr></table></figure>

<h4 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a><strong>字符流</strong></h4><ul>
<li>输入流：Reader/FileReader</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="keyword">char</span>[] cbuf);</span><br><span class="line">read(<span class="keyword">char</span>[] cbuf, <span class="keyword">int</span> off, <span class="keyword">int</span> len);</span><br><span class="line">close();</span><br></pre></td></tr></table></figure>

<ul>
<li>输出流：Writer/FileWriter</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">write(<span class="keyword">char</span>[] cbuf);</span><br><span class="line">write(<span class="keyword">char</span>[] cbuf, <span class="keyword">int</span> off, <span class="keyword">int</span> len);</span><br><span class="line">append(<span class="keyword">char</span> c);</span><br><span class="line">flush();</span><br><span class="line">close();</span><br></pre></td></tr></table></figure>

<h3 id="经典步骤"><a href="#经典步骤" class="headerlink" title="经典步骤"></a><strong>经典步骤</strong></h3><ul>
<li>建立联系</li>
<li>选择流</li>
<li>操作</li>
<li>释放资源</li>
</ul>
<h1 id="字节流–Input-OutputStream、FileInputOutputStream"><a href="#字节流–Input-OutputStream、FileInputOutputStream" class="headerlink" title="字节流–Input/OutputStream、FileInputOutputStream"></a><strong>字节流–Input/OutputStream、FileInputOutputStream</strong></h1><p>字节流可以处理伊西起文件，包括二进制文件/音频/视频等</p>
<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a><strong>读取文件</strong></h2><ul>
<li>建立联系–&gt;File 对象–源头</li>
<li>选择流–&gt;文件输入流–InputStream/FileInputStream</li>
<li>操作–&gt;read + 输出</li>
<li>释放资源–&gt;close</li>
</ul>
<h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a><strong>写入文件</strong></h2><ul>
<li>建立联系–&gt;File 对象–源头、目的地</li>
<li>选择流–&gt;文件输出流–OutputStream/FileOutputStream</li>
<li>操作–&gt;write + flush</li>
<li>释放资源–&gt;close</li>
</ul>
<h2 id="文件复制"><a href="#文件复制" class="headerlink" title="文件复制"></a><strong>文件复制</strong></h2><ul>
<li>建立联系–&gt;File 对象–源头、目的地</li>
<li>选择流–&gt;Input/OutputStream、FileInputOutputStream</li>
<li>操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] flush = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((len = 输入流.read(<span class="keyword">byte</span>)) != -<span class="number">1</span>)</span><br><span class="line">	输出流.write(flush, <span class="number">0</span>, len);</span><br><span class="line">输出流.flush;</span><br></pre></td></tr></table></figure>

<ul>
<li>释放资源</li>
</ul>
<h2 id="文件夹复制"><a href="#文件夹复制" class="headerlink" title="文件夹复制"></a><strong>文件夹复制</strong></h2><ul>
<li>递归查找子孙文件/文件夹</li>
<li>文件复制(IO 流复制)、文件夹创建</li>
</ul>
<h1 id="字符流–Reader-Writer、FileReader-FileWriter"><a href="#字符流–Reader-Writer、FileReader-FileWriter" class="headerlink" title="字符流–Reader/Writer、FileReader/FileWriter"></a><strong>字符流–Reader/Writer、FileReader/FileWriter</strong></h1><p>只能操作纯文本数据</p>
<h2 id="纯文本读取"><a href="#纯文本读取" class="headerlink" title="纯文本读取"></a><strong>纯文本读取</strong></h2><ul>
<li>建立联系–&gt;File 对象–源头</li>
<li>选择流–&gt;字符输出流–Reader/FileReader</li>
<li>操作–&gt;读取</li>
<li>释放资源–&gt;close</li>
</ul>
<h2 id="纯文本写入"><a href="#纯文本写入" class="headerlink" title="纯文本写入"></a><strong>纯文本写入</strong></h2><ul>
<li>建立联系–&gt;File 对象–目的地</li>
<li>选择流–&gt;字符输入流–Writer/FileReader</li>
<li>操作–&gt;write + flush</li>
<li>关闭–&gt;close</li>
</ul>
<h1 id="处理流"><a href="#处理流" class="headerlink" title="处理流"></a><strong>处理流</strong></h1><p>用来增强功能、提高性能，处于节点流之上</p>
<h2 id="缓冲流"><a href="#缓冲流" class="headerlink" title="缓冲流"></a><strong>缓冲流</strong></h2><ul>
<li>字节缓冲流–BufferedInputStream/BufferedOutputStream</li>
<li>字符缓冲流–BufferedReader/BufferedWriter</li>
</ul>
<h2 id="转换流"><a href="#转换流" class="headerlink" title="转换流"></a><strong>转换流</strong></h2><p>字节流转换为字符流，处理乱码</p>
<h3 id="编码与解码"><a href="#编码与解码" class="headerlink" title="编码与解码"></a><strong>编码与解码</strong></h3><ul>
<li>编码：字符–编码字符集–&gt;二进制</li>
<li>解码：二进制–解码字符集–&gt;字符</li>
</ul>
<h3 id="乱码"><a href="#乱码" class="headerlink" title="乱码"></a><strong>乱码</strong></h3><ul>
<li>编码与解码的字符集不一致</li>
<li>字节缺少，长度丢失</li>
<li>解决办法：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InputStreamReader(字节输入流, <span class="string">"解码集"</span>);</span><br><span class="line">OutputStreamWriter(字符输出流, <span class="string">"编码集"</span>);</span><br></pre></td></tr></table></figure>

<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-12-3/44267583.jpg" alt><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-12-3/88652044.jpg" alt></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/16/Python-BeautifulSoup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/16/Python-BeautifulSoup/" class="post-title-link" itemprop="url">Python-BeautifulSoup</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-16 14:50:41" itemprop="dateCreated datePublished" datetime="2018-11-16T14:50:41+08:00">2018-11-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:38" itemprop="dateModified" datetime="2019-10-15T10:03:38+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-lib/" itemprop="url" rel="index">
                    <span itemprop="name">Python lib</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python-BeautifulSoup的使用"><a href="#Python-BeautifulSoup的使用" class="headerlink" title="Python-BeautifulSoup的使用"></a>Python-BeautifulSoup的使用</h1><p>BeautiSoup，是借助网页的结构和属性等特性来解析网页的工具，有了它我们不用再去写一些复杂的正则，只需要简单的几条语句就可以完成网页中某个元素的提取。</p>
<h2 id="BeautifulSoup简介"><a href="#BeautifulSoup简介" class="headerlink" title="BeautifulSoup简介"></a>BeautifulSoup简介</h2><p>官方解释如下：<br>BeautifulSoup提供一些简单的、Python式的函数用来处理导航、搜索、修改分析树等功能。它是一个工具箱，通过解析文档为用户提供需要抓取的数据，因为简单，所以不需要多少代码就可以写出一个完整的应用程序。 BeautifulSoup 自动将输入文档转换为 Unicode 编码，输出文档转换为 utf-8 编码。你不需要考虑编码方式，除非文档没有指定一个编码方式，这时你仅仅需要说明一下原始编码方式就可以了。 BeautifulSoup 已成为和 lxml、html6lib 一样出色的 Python 解释器，为用户灵活地提供不同的解析策略或强劲的速度。</p>
<h2 id="解析器"><a href="#解析器" class="headerlink" title="解析器"></a>解析器</h2><p>BeautifulSoup 在解析的时候实际上是依赖于解析器的，它除了支持 Python 标准库中的 HTML 解析器，还支持一些第三方的解析器比如 LXML，下面我们对 BeautifulSoup 支持的解析器及它们的一些优缺点做一个简单的对比。<br><img src="https://t1.picb.cc/uploads/2018/11/16/JXuhZc.png" alt="enter image description here"></p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;p class="title" name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; and</span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;;</span></span><br><span class="line"><span class="string">and they lived at the bottom of a well.&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>) </span><br><span class="line">print(soup.prettify())  <span class="comment"># 把要解析的字符串以标准的缩进格式输出(自动更正格式)</span></span><br><span class="line">print(soup.title.string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line"> &lt;head&gt;</span><br><span class="line">  &lt;title&gt;</span><br><span class="line">   The Dormouse<span class="string">'s story</span></span><br><span class="line"><span class="string">  &lt;/title&gt;</span></span><br><span class="line"><span class="string"> &lt;/head&gt;</span></span><br><span class="line"><span class="string"> &lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;p class="title" name="dromouse"&gt;</span></span><br><span class="line"><span class="string">   &lt;b&gt;</span></span><br><span class="line"><span class="string">    The Dormouse'</span>s story</span><br><span class="line">   &lt;/b&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  &lt;p class="story"&gt;</span><br><span class="line">   Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">   &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;</span><br><span class="line">    &lt;!-- Elsie --&gt;</span><br><span class="line">   &lt;/a&gt;</span><br><span class="line">   ,</span><br><span class="line">   &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;</span><br><span class="line">    Lacie</span><br><span class="line">   &lt;/a&gt;</span><br><span class="line">   <span class="keyword">and</span></span><br><span class="line">   &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;</span><br><span class="line">    Tillie</span><br><span class="line">   &lt;/a&gt;</span><br><span class="line">   ;</span><br><span class="line"><span class="keyword">and</span> they lived at the bottom of a well.</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  &lt;p class="story"&gt;</span><br><span class="line">   ...</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line"> &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">The Dormouse<span class="string">'s story</span></span><br></pre></td></tr></table></figure>


<h2 id="节点选择器"><a href="#节点选择器" class="headerlink" title="节点选择器"></a>节点选择器</h2><h3 id="选择元素"><a href="#选择元素" class="headerlink" title="选择元素"></a>选择元素</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title)</span><br><span class="line">print(type(soup.title.string))</span><br><span class="line">print(soup.title.string)</span><br><span class="line">print(soup.head)</span><br><span class="line">print(soup.p)  <span class="comment"># 只选择第一个出现的p标签</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&lt;title&gt;The Dormouse<span class="string">'s story&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;class '</span>bs4.element.NavigableString<span class="string">'&gt;</span></span><br><span class="line"><span class="string">The Dormouse'</span>s story</span><br><span class="line">&lt;head&gt;&lt;title&gt;The Dormouse<span class="string">'s story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line">&lt;p class="title" name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h2 id="提取信息"><a href="#提取信息" class="headerlink" title="提取信息"></a>提取信息</h2><h4 id="获取名称"><a href="#获取名称" class="headerlink" title="获取名称"></a>获取名称</h4><p>可以利用 name 属性来获取节点的名称。还是以上面的文本为例，我们选取 title 节点，然后调用 name 属性就可以得到节点名称。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(soup.title.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">title</span><br></pre></td></tr></table></figure>

<h4 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h4><p>每个节点可能有多个属性，比如 id，class 等等，我们选择到这个节点元素之后，可以调用 attrs 获取所有属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">print(soup.p.attrs)</span><br><span class="line">print(soup.p.attrs[<span class="string">'name'</span>])</span><br><span class="line"><span class="comment">#更加简便的写法</span></span><br><span class="line">print(soup.p[<span class="string">'name'</span>])</span><br><span class="line">print(soup.p[<span class="string">'class'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&#123;<span class="string">'class'</span>: [<span class="string">'title'</span>], <span class="string">'name'</span>: <span class="string">'dromouse'</span>&#125;</span><br><span class="line">dromouse</span><br><span class="line">dromouse</span><br><span class="line">[<span class="string">'title'</span>]</span><br></pre></td></tr></table></figure>

<h4 id="获取内容"><a href="#获取内容" class="headerlink" title="获取内容"></a>获取内容</h4><p>可以利用 string 属性获取节点元素包含的文本内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(soup.p.string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">The Dormouse<span class="string">'s story</span></span><br></pre></td></tr></table></figure>

<h3 id="嵌套选择"><a href="#嵌套选择" class="headerlink" title="嵌套选择"></a>嵌套选择</h3><p>在上面的例子中我们知道每一个返回结果都是 bs4.element.Tag 类型，它同样可以继续调用节点进行下一步的选择，比如我们获取了 head 节点元素，我们可以继续调用 head 来选取其内部的 head 节点元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.head.title)</span><br><span class="line">print(type(soup.head.title))</span><br><span class="line">print(soup.head.title.string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&lt;title&gt;The Dormouse<span class="string">'s story&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;class '</span>bs4.element.Tag<span class="string">'&gt;</span></span><br><span class="line"><span class="string">The Dormouse'</span>s story</span><br></pre></td></tr></table></figure>

<h3 id="关联选择"><a href="#关联选择" class="headerlink" title="关联选择"></a>关联选择</h3><p>我们在做选择的时候有时候不能做到一步就可以选择到想要的节点元素，有时候在选择的时候需要先选中某一个节点元素，然后以它为基准再选择它的子节点、父节点、兄弟节点等等。</p>
<h4 id="子节点和子孙节点"><a href="#子节点和子孙节点" class="headerlink" title="子节点和子孙节点"></a>子节点和子孙节点</h4><p>选取到了一个节点元素之后，如果想要获取它的<strong>直接子节点</strong>可以调用 contents 属性。 contents 返回的是列表类型， children 返回的是生成器类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">print(soup.p.contents)</span><br><span class="line">print(soup.p.children)</span><br><span class="line">print(soup.p.contents)</span><br><span class="line"></span><br><span class="line">print(soup.p.children)</span><br><span class="line"><span class="keyword">for</span> i, child <span class="keyword">in</span> enumerate(soup.p.children):</span><br><span class="line">    print(i, child)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">['Once upon a time there were three little sisters; and their names were\n', &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;, ',\n', &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;, ' and\n', &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;, ';\nand they lived at the bottom of a well.']</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line"></span><br><span class="line">1 &lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;</span><br><span class="line"><span class="number">2</span> ,</span><br><span class="line"></span><br><span class="line">3 &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;</span><br><span class="line"><span class="number">4</span>  <span class="keyword">and</span></span><br><span class="line"></span><br><span class="line">5 &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;</span><br><span class="line"><span class="number">6</span> ;</span><br><span class="line"><span class="keyword">and</span> they lived at the bottom of a well.</span><br></pre></td></tr></table></figure>

<h4 id="父节点和祖先节点"><a href="#父节点和祖先节点" class="headerlink" title="父节点和祖先节点"></a>父节点和祖先节点</h4><p>如果要获取某个节点元素的直接父节点，可以调用 parent 属性，要想获取所有的祖先节点，可以调用 parents 。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">print(soup.a.parent)</span><br><span class="line">print(soup.a.parents)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span><br><span class="line">&lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt; and</span><br><span class="line">&lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;;</span><br><span class="line">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">[(0, &lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span><br><span class="line">&lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt; and</span><br><span class="line">&lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;;</span><br><span class="line">and they lived at the bottom of a well.&lt;/p&gt;), (1, &lt;body&gt;</span><br><span class="line">&lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span><br><span class="line">&lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt; and</span><br><span class="line">&lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;;</span><br><span class="line">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class="line">&lt;p class="story"&gt;...&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;), (2, &lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span><br><span class="line">&lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt; and</span><br><span class="line">&lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;;</span><br><span class="line">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class="line">&lt;p class="story"&gt;...&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;), (3, &lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse's story&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p class="story"&gt;Once upon a time there were three little sisters; and their names were</span><br><span class="line">&lt;a class="sister" href="http://example.com/elsie" id="link1"&gt;&lt;!-- Elsie --&gt;&lt;/a&gt;,</span><br><span class="line">&lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt; and</span><br><span class="line">&lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;;</span><br><span class="line">and they lived at the bottom of a well.&lt;/p&gt;</span><br><span class="line">&lt;p class="story"&gt;...&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;)]</span><br></pre></td></tr></table></figure>

<h4 id="兄弟节点"><a href="#兄弟节点" class="headerlink" title="兄弟节点"></a>兄弟节点</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">            Once upon a time there were three little sisters; and their names were</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">                &lt;span&gt;Elsie&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">            Hello</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; </span></span><br><span class="line"><span class="string">            and</span></span><br><span class="line"><span class="string">            &lt;a href="http://example.com/tillie" class="sister" id="link3"&gt;Tillie&lt;/a&gt;</span></span><br><span class="line"><span class="string">            and they lived at the bottom of a well.</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(<span class="string">'next_sibling'</span>, soup.a.next_sibling)</span><br><span class="line">print(<span class="string">'prev_sibling'</span>, soup.a.previous_sibling)</span><br><span class="line">print(<span class="string">'next_siblings'</span>, list(enumerate(soup.a.next_sibling)))</span><br><span class="line">print(<span class="string">'prev_siblings'</span>, list(enumerate(soup.a.previous_sibling)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">next_sibling </span><br><span class="line">            Hello</span><br><span class="line">            </span><br><span class="line">prev_sibling </span><br><span class="line">            Once upon a time there were three little sisters; <span class="keyword">and</span> their names were</span><br><span class="line">            </span><br><span class="line">next_siblings [(0, '\n            Hello\n            '), (1, &lt;a class="sister" href="http://example.com/lacie" id="link2"&gt;Lacie&lt;/a&gt;), (2, ' \n            and\n            '), (3, &lt;a class="sister" href="http://example.com/tillie" id="link3"&gt;Tillie&lt;/a&gt;), (4, '\n            and they lived at the bottom of a well.\n        ')]</span><br><span class="line">prev_siblings [(<span class="number">0</span>, <span class="string">'\n            Once upon a time there were three little sisters; and their names were\n            '</span>)]</span><br></pre></td></tr></table></figure>

<h2 id="方法选择器"><a href="#方法选择器" class="headerlink" title="方法选择器"></a>方法选择器</h2><p>前面讲的选择方法都是通过属性来选择元素的，这种选择方法非常快，但是如果要进行比较复杂的选择的话则会比较繁琐，不够灵活。所以 BeautifulSoup 还提供了一些查询的方法，比如 find_all()、find() 等方法，我们可以调用方法然后传入相应等参数就可以灵活地进行查询。</p>
<h3 id="find-all–查找所有符合条件的元素"><a href="#find-all–查找所有符合条件的元素" class="headerlink" title="find_all–查找所有符合条件的元素"></a>find_all–查找所有符合条件的元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list" id="list-1"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small" id="list-2"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(name = <span class="string">'ul'</span>))</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.find_all(name = <span class="string">'ul'</span>):</span><br><span class="line">    print(ul.find_all(name = <span class="string">'li'</span>))</span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> ul.find_all(name = <span class="string">'li'</span>):</span><br><span class="line">        print(li.string)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[&lt;ul class="list" id="list-1"&gt;</span><br><span class="line">&lt;li class="element"&gt;Foo&lt;/li&gt;</span><br><span class="line">&lt;li class="element"&gt;Bar&lt;/li&gt;</span><br><span class="line">&lt;li class="element"&gt;Jay&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;, &lt;ul class="list list-small" id="list-2"&gt;</span><br><span class="line">&lt;li class="element"&gt;Foo&lt;/li&gt;</span><br><span class="line">&lt;li class="element"&gt;Bar&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;]</span><br><span class="line">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;, &lt;li class="element"&gt;Jay&lt;/li&gt;]</span><br><span class="line">Foo</span><br><span class="line">Bar</span><br><span class="line">Jay</span><br><span class="line">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;]</span><br><span class="line">Foo</span><br><span class="line">Bar</span><br></pre></td></tr></table></figure>

<h3 id="attrs"><a href="#attrs" class="headerlink" title="attrs"></a>attrs</h3><p>根据属性进行查询</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(soup.find_all(attrs = &#123;<span class="string">'id'</span>: <span class="string">'list-1'</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[&lt;ul class="list" id="list-1"&gt;</span><br><span class="line">&lt;li class="element"&gt;Foo&lt;/li&gt;</span><br><span class="line">&lt;li class="element"&gt;Bar&lt;/li&gt;</span><br><span class="line">&lt;li class="element"&gt;Jay&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;]</span><br></pre></td></tr></table></figure>

<h3 id="text"><a href="#text" class="headerlink" title="text"></a>text</h3><p>text 参数可以用来匹配节点的文本，传入的形式可以是字符串，可以是正则表达式对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;a&gt;Hello, this is a link&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;a&gt;Hello, this is a link, too&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(text=re.compile(<span class="string">'link'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[<span class="string">'Hello, this is a link'</span>, <span class="string">'Hello, this is a link, too'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="find"><a href="#find" class="headerlink" title="find()"></a>find()</h3><p>find方法和find_all类似，只是返回的是第一个匹配的元素</p>
<h3 id="othres-API"><a href="#othres-API" class="headerlink" title="othres API"></a>othres API</h3><ul>
<li><p>find_parents() find_parent()<br>find_parents() 返回所有祖先节点，find_parent() 返回直接父节点。</p>
</li>
<li><p>find_next_siblings() find_next_sibling()<br>find_next_siblings() 返回后面所有兄弟节点，find_next_sibling() 返回后面第一个兄弟节点。</p>
</li>
<li><p>find_previous_siblings() find_previous_sibling()<br>find_previous_siblings() 返回前面所有兄弟节点，find_previous_sibling() 返回前面第一个兄弟节点。</p>
</li>
<li><p>find_all_next() find_next()<br>find_all_next() 返回节点后所有符合条件的节点, find_next() 返回第一个符合条件的节点。</p>
</li>
<li><p>find_all_previous() 和 find_previous()<br>find_all_previous() 返回节点后所有符合条件的节点, find_previous() 返回第一个符合条件的节点</p>
</li>
</ul>
<h2 id="CSS选择器"><a href="#CSS选择器" class="headerlink" title="CSS选择器"></a>CSS选择器</h2><p>BeautifulSoup 还提供了另外一种选择器，那就是 CSS 选择器。使用 CSS 选择器，只需要调用 select() 方法，传入相应的 CSS 选择器即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list" id="list-1"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small" id="list-2"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">print(soup.select(<span class="string">'.panel .panel-heading'</span>))</span><br><span class="line">print(soup.select(<span class="string">'ul li'</span>))</span><br><span class="line">print(soup.select(<span class="string">'#list-2 .element'</span>))</span><br><span class="line">print(type(soup.select(<span class="string">'ul'</span>)[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[&lt;div class="panel-heading"&gt;</span><br><span class="line">&lt;h4&gt;Hello&lt;/h4&gt;</span><br><span class="line">&lt;/div&gt;]</span><br><span class="line">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;, &lt;li class="element"&gt;Jay&lt;/li&gt;, &lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;]</span><br><span class="line">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;]</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">bs4</span>.<span class="title">element</span>.<span class="title">Tag</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="嵌套选择-1"><a href="#嵌套选择-1" class="headerlink" title="嵌套选择"></a>嵌套选择</h3><p>select() 方法同样支持嵌套选择，例如我们先选择所有 ul 节点，再遍历每个 ul 节点选择其 li 节点。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">    print(ul.select(<span class="string">'li'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;, &lt;li class="element"&gt;Jay&lt;/li&gt;]</span><br><span class="line">[&lt;li class="element"&gt;Foo&lt;/li&gt;, &lt;li class="element"&gt;Bar&lt;/li&gt;]</span><br></pre></td></tr></table></figure>

<h3 id="获取属性-1"><a href="#获取属性-1" class="headerlink" title="获取属性"></a>获取属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">    print(ul[<span class="string">'id'</span>])</span><br><span class="line">    print(ul.attrs[<span class="string">'id'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">list<span class="number">-1</span></span><br><span class="line">list<span class="number">-1</span></span><br><span class="line">list<span class="number">-2</span></span><br><span class="line">list<span class="number">-2</span></span><br></pre></td></tr></table></figure>

<h3 id="获取文本"><a href="#获取文本" class="headerlink" title="获取文本"></a>获取文本</h3><p>获取文本可以用前面所讲的 string 属性，还有一个方法那就是 get_text()。</p>
<pre><code class="python"><span class="keyword">for</span> li <span class="keyword">in</span> soup.select(<span class="string">'li'</span>):
    print(<span class="string">'Get Text:'</span>, li.get_text())
    print(<span class="string">'String:'</span>, li.string)

<span class="comment"># 输出</span>
Get Text: Foo
String: Foo
Get Text: Bar
String: Bar
Get Text: Jay
String: Jay
Get Text: Foo
String: Foo
Get Text: Bar
String: Bar</code></pre>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/15/Python-正则表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/15/Python-正则表达式/" class="post-title-link" itemprop="url">Python-正则表达式</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-15 19:55:58" itemprop="dateCreated datePublished" datetime="2018-11-15T19:55:58+08:00">2018-11-15</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:38" itemprop="dateModified" datetime="2019-10-15T10:03:38+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-reg/" itemprop="url" rel="index">
                    <span itemprop="name">Python reg</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><ul>
<li>正则表达式匹配，就是按照一定的规则将特定的文本提取出来。<br><img src="https://t1.picb.cc/uploads/2018/11/15/JXfxNi.jpg" alt="enter image description here"></li>
</ul>
<h2 id="match"><a href="#match" class="headerlink" title="match"></a>match</h2><ul>
<li>match(0)法会尝试从字符串的<strong>起始位置</strong>匹配正则表达式，如果匹配，就返回匹配成功的结果；如果不匹配，就返回 false。</li>
</ul>
<h2 id="match-示例"><a href="#match-示例" class="headerlink" title="match 示例"></a>match 示例</h2><h3 id="匹配目标"><a href="#匹配目标" class="headerlink" title="匹配目标"></a>匹配目标</h3><ul>
<li>可以使用”（）”将想提取的子字符串括起来，”（）”实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用 group()法传入分组的索引即可获取提取的结果。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line">result0 = re.match(<span class="string">'^Hello\s\d\d\d\s\d&#123;4&#125;\s\w&#123;10&#125;'</span>, content)</span><br><span class="line">result1 = re.match(<span class="string">'^Hello\s(\d+)\s(\d+)\sWorld'</span>, content)</span><br><span class="line">print(result0)</span><br><span class="line">print(result1)</span><br><span class="line">print(result1.group(<span class="number">1</span>), result1.group(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&lt;re.Match object; span=(<span class="number">0</span>, <span class="number">25</span>), match=<span class="string">'Hello 123 4567 World_This'</span>&gt;</span><br><span class="line">&lt;re.Match object; span=(<span class="number">0</span>, <span class="number">20</span>), match=<span class="string">'Hello 123 4567 World'</span>&gt;</span><br><span class="line"><span class="number">123</span> <span class="number">4567</span></span><br></pre></td></tr></table></figure>

<h3 id="通用匹配"><a href="#通用匹配" class="headerlink" title="通用匹配"></a>通用匹配</h3><ul>
<li>”.*“可以匹配任意长度字符串(换行符除外)。</li>
<li>”.“可以匹配任意字符(换行符除外)</li>
<li>”*“代表匹配前面的字符无限次</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line">result = re.match(<span class="string">'^Hello\s(\d+)\s(\d+)\s(.*?)Demo$'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">&lt;re.Match object; span=(<span class="number">0</span>, <span class="number">41</span>), match=<span class="string">'Hello 123 4567 World_This is a Regex Demo'</span>&gt;</span><br><span class="line">World_This <span class="keyword">is</span> a Regex</span><br></pre></td></tr></table></figure>

<h3 id="贪婪匹配"><a href="#贪婪匹配" class="headerlink" title="贪婪匹配"></a>贪婪匹配</h3><p>使用”.*“通用匹配时，可能会得不到想要的结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line"></span><br><span class="line">result = re.match(<span class="string">'^He.*(\d+).*Demo$'</span>, content)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure>

<p>想要的结果是 123，却输出了 7。这就涉及到贪婪与非贪婪匹配了。</p>
<ul>
<li>在贪婪匹配下， “._”会匹配尽可能多的字符。<br>所以在上面的正则表达式中，”._“直接匹配到了’Hello 123 456’，’\d’匹配到了’7’。</li>
<li>在非贪婪匹配下， “.<em>“会匹配尽可能少的字符。非贪婪匹配的写法是”.</em>?”。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line">result = re.match(<span class="string">'^He.*?(\d+).*Demo$'</span>, content)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>

<p>在做匹配的时候，字符串<strong>中间尽量使用非贪婪匹配</strong>，但需要注意，如果匹配的结果在字符串结尾，”.*?”就有可能匹配不到任何内容了。</p>
<h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><p>正则表达式可以包含一些<strong>可选标志修饰符来控制匹配的模式</strong> 。<br><img src="https://t1.picb.cc/uploads/2018/11/15/JX62zc.png" alt="enter image description here"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''Hello 123 4567 World_This</span></span><br><span class="line"><span class="string">          is a Regex Demo'''</span></span><br><span class="line">result_none = re.match(<span class="string">'^He.*?(\d+).*Demo$'</span>, content)</span><br><span class="line">print(result_none)</span><br><span class="line"></span><br><span class="line">result = re.match(<span class="string">'^He.*?(\d+).*Demo$'</span>, content, re.S)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line">&lt;re.Match object; span=(<span class="number">0</span>, <span class="number">52</span>), match=<span class="string">'Hello 123 4567 World_This \n          is a Regex &gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="转义匹配"><a href="#转义匹配" class="headerlink" title="转义匹配"></a>转义匹配</h3><p>当遇到用于正则匹配模式的特殊字符时，在前面加反斜线转义一下即可 。</p>
<h2 id="search"><a href="#search" class="headerlink" title="search"></a>search</h2><p>search ()，它在匹配时会扫描整个字符串，然后返回第一个成功匹配的结果 。</p>
<h3 id="search-示例"><a href="#search-示例" class="headerlink" title="search 示例"></a>search 示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>, html, re.S)</span><br><span class="line">print(result.group(<span class="number">1</span>), result.group(<span class="number">2</span>))</span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?href="(.*?)"\ssinger="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>, html, re.S)</span><br><span class="line"><span class="comment">#print(result)</span></span><br><span class="line">print(result.group(<span class="number">1</span>), result.group(<span class="number">2</span>), result.group(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">任贤齐 沧海一声笑</span><br><span class="line">/<span class="number">2.</span>mp3 任贤齐 沧海一声笑</span><br></pre></td></tr></table></figure>

<h2 id="findall"><a href="#findall" class="headerlink" title="findall"></a>findall</h2><p>findall()方法会搜索整个字符串然后返回匹配正则表达式的所有内容。</p>
<h3 id="findall-示例"><a href="#findall-示例" class="headerlink" title="findall 示例"></a>findall 示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>, html, re.S)</span><br><span class="line">print(result.group(<span class="number">1</span>), result.group(<span class="number">2</span>))</span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?href="(.*?)"\ssinger="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>, html, re.S)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">任贤齐 沧海一声笑</span><br><span class="line">/<span class="number">2.</span>mp3 任贤齐 沧海一声笑</span><br><span class="line">/<span class="number">2.</span>mp3 任贤齐 沧海一声笑</span><br><span class="line">/<span class="number">3.</span>mp3 齐秦 往事随风</span><br><span class="line">/<span class="number">4.</span>mp3 beyond 光辉岁月</span><br><span class="line">/<span class="number">5.</span>mp3 陈慧琳 记事本</span><br></pre></td></tr></table></figure>

<h2 id="sub"><a href="#sub" class="headerlink" title="sub"></a>sub</h2><p>用来修改/替换文本</p>
<h3 id="sub-使用示例"><a href="#sub-使用示例" class="headerlink" title="sub 使用示例"></a>sub 使用示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'54ak54yr50ir54ix5L2g'</span></span><br><span class="line">content = re.sub(<span class="string">'\d'</span>, <span class="string">''</span>, content)</span><br><span class="line">print(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">akyririxLg</span><br></pre></td></tr></table></figure>

<h2 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h2><p>compile()可以将正则字符串编译成正则表达式对象，以便在以后的匹配中复用(也可以传入修饰符)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content0 = <span class="string">'2016-12-15 12:00'</span></span><br><span class="line">content1 = <span class="string">'2016-12-17 12:55'</span></span><br><span class="line">content2 = <span class="string">'2016-12-22 13:21'</span></span><br><span class="line"></span><br><span class="line">pattern = re.compile(<span class="string">'\d&#123;2&#125;:\d&#123;2&#125;'</span>)</span><br><span class="line">result0 = re.sub(pattern, <span class="string">''</span>, content1)</span><br><span class="line">result1 = re.sub(pattern, <span class="string">''</span>, content1)</span><br><span class="line">result2 = re.sub(pattern, <span class="string">''</span>, content2)</span><br><span class="line"></span><br><span class="line">print(result0, result1, result2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="number">2016</span><span class="number">-12</span><span class="number">-17</span>  <span class="number">2016</span><span class="number">-12</span><span class="number">-17</span>  <span class="number">2016</span><span class="number">-12</span><span class="number">-22</span></span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/14/MySQL-锁/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/14/MySQL-锁/" class="post-title-link" itemprop="url">MySQL-锁</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-14 21:17:51" itemprop="dateCreated datePublished" datetime="2018-11-14T21:17:51+08:00">2018-11-14</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:38" itemprop="dateModified" datetime="2019-10-15T10:03:38+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库-MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">数据库 MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL-锁"><a href="#MySQL-锁" class="headerlink" title="MySQL-锁"></a>MySQL-锁</h1><h2 id="什么是锁"><a href="#什么是锁" class="headerlink" title="什么是锁"></a>什么是锁</h2><ul>
<li>锁机制用于管理对共享资源的并发访问</li>
</ul>
<h2 id="lock与latch"><a href="#lock与latch" class="headerlink" title="lock与latch"></a>lock与latch</h2><ul>
<li>latch一般称为闩锁（轻量级的锁） ， 因为其要求锁定的时间必须非常短。 若持续的时间长， 则应用的性能会非常差。 在InnoDB存储引擎中， latch又可以分为mutex（互斥量）和rwlock（读写锁）。其目是用来保证并发线程操作临界资源的正确性， 并且通常没有死锁检测的机制。</li>
<li>lock的对象是事务，用来锁定的是数据库中的对象，如表、页、行。并且一般lock的对象仅在事commit或rollback后进行释放（不同事务隔离级别释放的时间可能不同）。此外，lock，正如在大多数数据库中一样，是有死锁机制的。</li>
</ul>
<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/84119853.jpg" alt="enter image description here"></p>
<h2 id="InnoDB存储引擎中的锁"><a href="#InnoDB存储引擎中的锁" class="headerlink" title="InnoDB存储引擎中的锁"></a>InnoDB存储引擎中的锁</h2><h3 id="锁的类型"><a href="#锁的类型" class="headerlink" title="锁的类型"></a>锁的类型</h3><ul>
<li>共享锁（S Lock），允许事务读一行数据</li>
<li>排他锁（X Lock），允许事务删除或更新一行数据</li>
<li>意向锁（Intention Lock）是将锁定的对象分为多个层次，意向锁意味着事务希望在更细粒度（fine granularity）上进行加锁。对最细粒度的对象进行上锁， 那么首先需要对粗粒度的对象上锁。<h4 id="各种锁之间的兼容性"><a href="#各种锁之间的兼容性" class="headerlink" title="各种锁之间的兼容性"></a>各种锁之间的兼容性</h4><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/91462658.jpg" alt="enter image description here"><h4 id="三张表"><a href="#三张表" class="headerlink" title="三张表"></a>三张表</h4></li>
<li>INNODB_TRX显示了当前运行的InnoDB事务</li>
<li>INNODB_LOCKS查看锁</li>
<li>INNODB_LOCK_WAITS可以很直观地反映当前事务的等待</li>
</ul>
<h3 id="一致性非锁定读"><a href="#一致性非锁定读" class="headerlink" title="一致性非锁定读"></a>一致性非锁定读</h3><ul>
<li>一致性的非锁定读（consistent nonlocking read） 是指InnoDB存储引擎通过行多版本控制（multi versioning） 的方式来读取当前执行时间数据库中行的数据。 如果读取的行正在执行DELETE或UPDATE操作， 这时读取操作不会因此去等待行上锁的释放。 相反地，InnoDB存储引擎会去读取行的一个快照数据。非锁定读机制大大地提高了数据库的并发性。<br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/66097705.jpg" alt="enter image description here"><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4></li>
<li>在READ COMMITTED事务隔离级别下，对于快照数据，非一致性读总是读取被锁定行的最新一份快照数据(<strong>违反了隔离性</strong>)。 而在REPEATABLE READ事务隔离级别下，对于快照数据，非一致性读总是读取事务开始时的行数据版本。</li>
</ul>
<h3 id="一致性锁定读"><a href="#一致性锁定读" class="headerlink" title="一致性锁定读"></a>一致性锁定读</h3><p>用户需要显式地对数据库读取操作进行加锁以保证数据逻辑的一致性。</p>
<h3 id="自增长与锁"><a href="#自增长与锁" class="headerlink" title="自增长与锁"></a>自增长与锁</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><ul>
<li>插入操作会依据这个自增长的计数器值加1赋予自增长列。这个实现方式称做AUTO-INC Locking。这种锁其实是采用一种特殊的表锁机制，为了提高插入的性能，锁不是在一个事务完成后才释放，而是在完成对自增长值插入的SQL语句后立即释放。</li>
<li>虽然AUTO-INC Locking从一定程度上提高了并发插入的效率， 但还是存在一些性能上的问题。 首先， 对于有自增长值的列的并发插入性能较差， 事务必须等待前一个插入的完成（虽然不用等待事务的完成） 。 其次， 对于INSERT…SELECT的大数据量的插入会影响插入的性能， 因为另一个事务中的插入会被阻塞。</li>
</ul>
<h4 id="自增长的模式"><a href="#自增长的模式" class="headerlink" title="自增长的模式"></a>自增长的模式</h4><ul>
<li>参数innodb_autoinc_lock_mode来控制自增长的模式<br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/49495821.jpg" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/26079309.jpg" alt="enter image description here"></li>
</ul>
<h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><ul>
<li>在InnoDB存储引擎中， 自增长值的列必须是索引， 同时必须是索引的第一个列。 如果不是第一个列， 则MySQL数据库会抛出异常， 而MyISAM存储引擎没有这个问题。<br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/60316580.jpg" alt="enter image description here"></li>
</ul>
<h3 id="外键与锁"><a href="#外键与锁" class="headerlink" title="外键与锁"></a>外键与锁</h3><ul>
<li>对于外键值的插入或更新，首先需要查询父表中的记录，即SELECT父表。但是对于父表的SELECT操作，不是使用一致性非锁定读的方式，因为这样会发生数据不一致的问题，因此这时使用的是SELECT…LOCK IN SHARE MODE方式，即主动对父表加一个S锁。如果这时父表上已经这样加X锁，子表上的操作会被阻塞。</li>
</ul>
<h2 id="锁的算法"><a href="#锁的算法" class="headerlink" title="锁的算法"></a>锁的算法</h2><h3 id="行锁的三种算法"><a href="#行锁的三种算法" class="headerlink" title="行锁的三种算法"></a>行锁的三种算法</h3><ul>
<li>Record Lock：单个行记录上的锁。</li>
<li>Gap Lock：间隙锁，锁定一个范围，但不包含记录本身。</li>
<li>Next-Key Lock∶Gap Lock+Record Lock，锁定一个范围，并且锁定记录本身。</li>
</ul>
<h3 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h3><ul>
<li>当查询的索引含有唯一属性时，InnoDB存储引擎会对Next-Key Lock进行优化，将其降级为Record Lock，即仅锁住索引本身， 而不是范围。</li>
<li>在InnoDB存储引擎中， 对于INSERT的操作， 其会检查插入记录的下一条记录是否被锁定， 若已经被锁定， 则不允许查询。 </li>
</ul>
<h3 id="解决phantom-problem–针对其他提交前后，读取数据条数的对比"><a href="#解决phantom-problem–针对其他提交前后，读取数据条数的对比" class="headerlink" title="解决phantom problem–针对其他提交前后，读取数据条数的对比"></a>解决phantom problem–针对其他提交前后，读取数据条数的对比</h3><ul>
<li>Phantom Problem是指在同一事务下，连续执行两次同样的SQL语句可能导致不同的结果，第二次的SQL语句可能会返回<strong>之前不存在的行，违反了事务的隔离性</strong>。</li>
<li>InnoDB存储引擎采用Next-Key Locking的算法避免Phantom Problem。</li>
</ul>
<h4 id="幻影读示例"><a href="#幻影读示例" class="headerlink" title="幻影读示例"></a>幻影读示例</h4><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/92904378.jpg" alt="enter image description here"></p>
<h4 id="解决幻影读"><a href="#解决幻影读" class="headerlink" title="解决幻影读"></a>解决幻影读</h4><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/19298541.jpg" alt="enter image description here"></p>
<h2 id="锁问题"><a href="#锁问题" class="headerlink" title="锁问题"></a>锁问题</h2><p>深入理解脏读/幻影读/不可重复读/丢失更新的区别：<a href="https://www.cnblogs.com/Hakuna-Matata/p/7772794.html" target="_blank" rel="noopener">https://www.cnblogs.com/Hakuna-Matata/p/7772794.html</a></p>
<h3 id="脏读–针对未提交数据"><a href="#脏读–针对未提交数据" class="headerlink" title="脏读–针对未提交数据"></a>脏读–针对未提交数据</h3><h4 id="脏页"><a href="#脏页" class="headerlink" title="脏页"></a>脏页</h4><ul>
<li>脏页指的是在缓冲池中已经被修改的页，但是还没有刷新到磁盘中，即数据库实例内存中的页和磁盘中的页的数据是不一致的。</li>
</ul>
<h4 id="脏数据"><a href="#脏数据" class="headerlink" title="脏数据"></a>脏数据</h4><ul>
<li>脏数据是指事务对缓冲池中行记录的修改，并且还没有被提交（commit）。</li>
</ul>
<h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><ul>
<li>脏读指的就是在不同的事务下， 当前事务可以<strong>读到另外事务未提交的数据</strong>， 简单来说就是可以读到脏数据。</li>
<li>对于脏页的读取，是非常正常的，但如果读到了脏数据，即一个事务可以读到另外一个事务中未提交的数据，则显然<strong>违反了数据库的隔离性</strong>。脏读发生的条件是需要事务的隔离级别为READ UNCOMMITTED。</li>
<li>脏读隔离看似毫无用处， 但在一些比较特殊的情况下还是可以将事务的隔离级别设置为READ UNCOMMITTED。 例如replication环境中的slave节点， 并且在该slave上的查询并<br>不需要特别精确的返回值。</li>
</ul>
<h4 id="脏读示例"><a href="#脏读示例" class="headerlink" title="脏读示例"></a>脏读示例</h4><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/27843486.jpg" alt="enter image description here"></p>
<h4 id="解决脏读"><a href="#解决脏读" class="headerlink" title="解决脏读"></a>解决脏读</h4><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/90598726.jpg" alt="enter image description here"></p>
<h3 id="不可重复读–针对其他提交前后，读取数据本身的对比"><a href="#不可重复读–针对其他提交前后，读取数据本身的对比" class="headerlink" title="不可重复读–针对其他提交前后，读取数据本身的对比"></a>不可重复读–针对其他提交前后，读取数据本身的对比</h3><ul>
<li>不可重复读是指在一个事务内多次读取同一数据集合。在这个事务还没有结束时，另外一个事务也访问该同一数据集合，并做了一些<strong>DML操作</strong>。这样就发生了在一个事务内两次读到的数据是不一样。</li>
<li>在InnoDB存储引擎中，通过使用Next-Key Lock算法来避免不可重复读的问题。</li>
<li>不可重复读和脏读的区别是： 脏读是读到未提交的数据， 而不可重复读读到的却是已经提交的数据， 但是其<strong>违反了数据库事务一致性</strong>的要求。</li>
<li>一般来说， 不可重复读的问题是可以接受的， 因为其读到的是已经提交的数据， 本身并不会带来很大的问题。 因此， 很多数据库厂商（如Oracle、 Microsoft SQL Server） 将其数据库事务的默认隔离级别设置为READ COMMITTED， 在这种隔离级别下允许不可重复读的现象。</li>
<li>在InnoDB存储引擎中， 通过使用<strong>Next-Key Lock</strong>算法来避免不可重复读的问题。 在NextKey Lock算法下， 对于索引的扫描， 不仅是锁住扫描到的索引， 而且还锁住这些索引覆盖的范围（gap） 。 因此在这个范围内的插入都是不允许的。 这样就避免了另外的事务在这个范围内插入数据导致的不可重复读的问题。 因此， InnoDB存储引擎的默认事务隔离级别是READ REPEATABLE， 采用Next-Key Lock算法， 避免了不可重复读的现象。</li>
</ul>
<h4 id="不可重复读示例"><a href="#不可重复读示例" class="headerlink" title="不可重复读示例"></a>不可重复读示例</h4><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/61438726.jpg" alt="enter image description here"></p>
<h3 id="丢失更新"><a href="#丢失更新" class="headerlink" title="丢失更新"></a>丢失更新</h3><ul>
<li>丢失更新是另一个锁导致的问题，简单来说其就是一个事务的更新操作会被另一个事<br>务的更新操作所<strong>覆盖</strong>，从而导致数据的不一致。</li>
<li>要避免丢失更新， 需要让事务在这种情况下的操作变成<strong>串行化</strong>。</li>
</ul>
<h3 id="总结–仅供参考"><a href="#总结–仅供参考" class="headerlink" title="总结–仅供参考"></a>总结–<strong>仅供参考</strong></h3><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/33516594.jpg" alt="enter image description here"></p>
<h2 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h2><ul>
<li>在默认情况下InnoDB存储引擎不会回滚超时引发的错误异常。其实InnoDB存储引擎在大部分情况下都不会对异常进行回滚。</li>
</ul>
<h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><h3 id="死锁的概念及解决"><a href="#死锁的概念及解决" class="headerlink" title="死锁的概念及解决"></a>死锁的概念及解决</h3><ul>
<li>解决死锁问题最简单的一种方法是超时，即当两个事务互相等待时，当一个等待时间超过设置的某一阈值时，其中一个事务进行回滚，另一个等待的事务就能继续进行.</li>
<li>当前数据库还都普遍采用wait-for graph（等待图）的方式来进行死锁检测：<ul>
<li>锁的信息链表</li>
<li>事务等待链表</li>
</ul>
</li>
</ul>
<h3 id="死锁概率"><a href="#死锁概率" class="headerlink" title="死锁概率"></a>死锁概率</h3><ul>
<li>事务发生死锁的概率与以下几点因素有关：<ul>
<li>系统中事务的数量（n） ， 数量越多发生死锁的概率越大。</li>
<li>每个事务操作的数量（r） ， 每个事务操作的数量越多， 发生死锁的概率越大。</li>
<li>操作数据的集合（R） ， 越小则发生死锁的概率越大。</li>
</ul>
</li>
</ul>
<h3 id="死锁示例"><a href="#死锁示例" class="headerlink" title="死锁示例"></a>死锁示例</h3><p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/71303703.jpg" alt="enter image description here"></p>
<h2 id="锁升级"><a href="#锁升级" class="headerlink" title="锁升级"></a>锁升级</h2><ul>
<li>锁升级（Lock Escalation）是指将当前锁的粒度降低(减少开销)</li>
<li>InnoDB存储引擎不存在锁升级的问题。因为其不是根据每个记录来产生行锁的，相反，其根据每个事务访问的每个页对锁进行管理的，采用的是位图的方式。因此不管一个事务锁住页中一个记录还是多个记录，其开销通常都是一致的。</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/14/Python-requests库的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/14/Python-requests库的使用/" class="post-title-link" itemprop="url">Python-requests库的使用</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-14 11:41:55" itemprop="dateCreated datePublished" datetime="2018-11-14T11:41:55+08:00">2018-11-14</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:38" itemprop="dateModified" datetime="2019-10-15T10:03:38+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-lib/" itemprop="url" rel="index">
                    <span itemprop="name">Python lib</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python-requests库的使用"><a href="#Python-requests库的使用" class="headerlink" title="Python-requests库的使用"></a>Python-requests库的使用</h1><p>urllib 的用法中有一些不方便的地方，比如处理网页验证和Cooki es 时，需要写 Opener 和 Handler 来处理。 为了更加方便地实现这些操作，就有了更为强大的库requests ，有了它 ， Cookies 、登录验证、代理设置等操作都变得极为简单。</p>
<h2 id="一切以官网为主"><a href="#一切以官网为主" class="headerlink" title="一切以官网为主"></a>一切以官网为主</h2><p><a href="http://docs.python-requests.org/en/master/" target="_blank" rel="noopener">http://docs.python-requests.org/en/master/</a></p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="一个简单的例子"><a href="#一个简单的例子" class="headerlink" title="一个简单的例子"></a>一个简单的例子</h3><p>urllib库中的 urlopen()法实际上是以GET方式请求网页，而requests中相应的方法就是get()<br>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.text)</span><br><span class="line">print(response.cookies)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JShz6r.png" alt="enter image description here"></p>
<h3 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h3><h4 id="基本实例"><a href="#基本实例" class="headerlink" title="基本实例"></a>基本实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">print(<span class="string">'simple test'</span>)</span><br><span class="line">response = requests.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'params test'</span>)</span><br><span class="line">data = &#123;<span class="string">'name'</span>: <span class="string">'germey'</span>, <span class="string">'age'</span>: <span class="number">22</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">'https://httpbin.org/get'</span>, params=data)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将json格式解析为字典格式</span></span><br><span class="line">print(<span class="string">'json() test'</span>)</span><br><span class="line">response = requests.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.json())</span><br><span class="line">print(type(response.json()))</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JShDOJ.png" alt="enter image description here"><br><img src="https://t1.picb.cc/uploads/2018/11/14/JShYg1.png" alt="enter image description here"><br><img src="https://t1.picb.cc/uploads/2018/11/14/JShEP0.png" alt="enter image description here"></p>
<h4 id="抓取网页"><a href="#抓取网页" class="headerlink" title="抓取网页"></a>抓取网页</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re</span><br><span class="line"></span><br><span class="line">print(<span class="string">'抓取网页测试'</span>)</span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0'</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">'https://www.zhihu.com/explore'</span>, headers = headers)</span><br><span class="line">pattern = re.compile(<span class="string">'explore-feed.*?question_link.*?&gt;(.*?)&lt;/a&gt;'</span>, re.S)</span><br><span class="line">title = re.findall(pattern, response.text)</span><br><span class="line">print(title)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSvydu.png" alt="enter image description here"></p>
<h4 id="抓取二进制数据"><a href="#抓取二进制数据" class="headerlink" title="抓取二进制数据"></a>抓取二进制数据</h4><p>图片、音频、视频这些文件本质上都是由二进制码组成的，由于有特定的保存格式和对应的解析方式， 我们才可以看到这些形形色色的多媒体 。 所以，想要抓取它们，就要拿到它们的二进制码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">print(<span class="string">'抓取二进制数据测试'</span>)</span><br><span class="line">response = requests.get(<span class="string">'https://github.com/favicon.ico'</span>)</span><br><span class="line">print(response.text)</span><br><span class="line">print(response.content)  <span class="comment"># Content of the response, in bytes</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'favicon.ico'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSvJuD.png" alt="enter image description here"></p>
<h4 id="添加headers"><a href="#添加headers" class="headerlink" title="添加headers"></a>添加headers</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'添加headers测试'</span>)</span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0'</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">'https://www.zhihu.com/explore'</span>, headers = headers)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSvgsi.png" alt="enter image description here"></p>
<h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'name'</span>: <span class="string">'germy'</span>, <span class="string">'age'</span>: <span class="string">'22'</span>&#125;</span><br><span class="line">response = requests.post(<span class="string">'https://httpbin.org/post'</span>, data=data)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSvt6L.png" alt="enter image description here"></p>
<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>发送请求后，得到的自然就是响应 。 在上面的实例中，我们使用 text 和 content 获取了响应的内容。 此外，还有很多属性和方法可以用来获取其他信息，比如状态码、响应头、 Cookies 等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">print(<span class="string">'响应测试'</span>)</span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0'</span>&#125;</span><br><span class="line">response = requests.get(<span class="string">'https://www.jianshu.com'</span>, headers = headers)</span><br><span class="line">print(response.headers)</span><br><span class="line">print(response.cookies)</span><br><span class="line"><span class="comment"># print(response.status_code)</span></span><br><span class="line">exit() <span class="keyword">if</span> <span class="keyword">not</span> response.status_code == requests.codes.ok <span class="keyword">else</span> print(<span class="string">'request successfully'</span>)</span><br><span class="line">print(response.content)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSx5ST.png" alt="enter image description here"></p>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>: open(<span class="string">'favicon.ico'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line">response = requests.post(<span class="string">'https://httpbin.org/post'</span>, files = files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSxvT1.png" alt="enter image description here"></p>
<h3 id="会话维持"><a href="#会话维持" class="headerlink" title="会话维持"></a>会话维持</h3><p>在 requests 中，如果直接利用 get()、post()等方法的确可以做到模拟网页的请求，但是这实际上是相当于不同的会话，也就是说相当于用了两个浏览器打开了不同的页面，其实解决这个问题的主要方法就是维持同一个会话 ， 也就是相当于打开一个新的浏览器选项卡而不是新开一个浏览器 。 但是又不想每次设置 cookies ，那该怎么办呢？这时候就有了新的利器–Session 对象 。利用它，我们可以方便地维护一个会话，而且不用担心cookies的问题，它会帮我们自动处理好。利用 Session ，可以做到模拟同一个会话而不用担心 Cookies 的问题。 它通常用于模拟登录成功之后再进行下一步的操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">print(<span class="string">'session测试'</span>)</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.get(<span class="string">'https://httpbin.org/cookies/set/number/123456789'</span>)</span><br><span class="line">response = session.get(<span class="string">'https://httpbin.org/cookies'</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/14/JSLtir.png" alt="enter image description here"></p>
<h3 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h3><p>如果请求一个 HTTPS 站点，但是证书验证错误的页面时，就会报这样的错误，那么如何避免这个错误呢？很简单，把 verify 参数设置为False 即可。当然，我们也可以指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings()  <span class="comment"># 忽略警告</span></span><br><span class="line">logging.captureWarnings(true)  <span class="comment"># 捕获警告</span></span><br><span class="line">response = requests.get(url, **verify = false**)  <span class="comment"># 设置verify</span></span><br><span class="line">response = requests.get(url, cert = (crt_path, key_path))  <span class="comment"># 设置证书文件地址</span></span><br><span class="line">print(response)</span><br></pre></td></tr></table></figure>

<h3 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h3><p>对于某些网站，在测试的时候请求几次 ， 能正常获取内容。 但是一旦开始大规模爬取，对于大规模且频繁的请求，网站可能会弹出验证码，或者跳转到登录认证页面 ， 更甚者可能会直接封禁客户端的 IP ，导致一定时间段内无法访问 。那么，为了防止这种情况发生，我们需要设置代理来解决这个问题，这就需要用到 proxies 参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;<span class="string">'http'</span>: <span class="string">'...'</span></span><br><span class="line">		   <span class="string">'https'</span>: <span class="string">'...'</span></span><br><span class="line">		   ...</span><br><span class="line">		   &#125;</span><br><span class="line">response = requests.get(url, proxies = proxies)</span><br></pre></td></tr></table></figure>

<h3 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h3><p>在本机网络状况不好或者服务器网络响应太慢甚至无响应时，我们可能会等待特别久的时间才可能收到响应，甚至到最后收不到响应而报错。 为了防止服务器不能及时响应，应该设置一个超时时间 ，即超过了这个时间还没有得到响应，那就报错。 这需要用到 timeout 参数。 这个时间的计算是发归请求到服务器返回响应的时间。实际上，请求分两个阶段，即连接()connect )和读取(read )。如果想永久等待，可以直接将 timeout 设置为 None(默认) 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">print(<span class="string">'有timeout异常捕获'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'https://www.baidu.com'</span>, timeout = <span class="number">0.01</span>)</span><br><span class="line">    print(response.status_code)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.Timeout:</span><br><span class="line">    print(<span class="string">'Timeout'</span>)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">    print(<span class="string">'ConnextionError'</span>)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.HTTPError:</span><br><span class="line">    print(<span class="string">'HTTPError'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'无timeout异常捕获'</span>)</span><br><span class="line">response = requests.get(<span class="string">'https://www.baidu.com'</span>, timeout = (<span class="number">0.01</span>, <span class="number">0.01</span>))</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>

<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/91035917.jpg" alt="enter image description here"></p>
<h3 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">response = requests.get(url, auth=HTTPBasicAuth(username, userpassword))</span><br><span class="line">response = requests,get(url, auth=(username, userpassword))</span><br></pre></td></tr></table></figure>

<h3 id="prepared-request"><a href="#prepared-request" class="headerlink" title="prepared request"></a>prepared request</h3><p>前面介绍 urllib 时，我们可以将请求表示为数据结构，其中各个参数都可以通过一个 Request 对象来表示 。 这在 requests 里同样可以做到，这个数据结构就叫 Prepared Request。有了 Request 这个对象，就可以将请求当作独立的对象来看待，这样在进行队列调度时会非常方便。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request, Session</span><br><span class="line"></span><br><span class="line">print(<span class="string">'prepared request测试'</span>)</span><br><span class="line">url = <span class="string">'https://httpbin.org/post'</span></span><br><span class="line">data = &#123;<span class="string">'name'</span>: <span class="string">'germey'</span>&#125;</span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0'</span>&#125;</span><br><span class="line"></span><br><span class="line">session = Session()</span><br><span class="line">request = Request(<span class="string">'POST'</span>, url, data = data, headers = headers)</span><br><span class="line">prepped = session.prepare_request(request)</span><br><span class="line">response = session.send(prepped)</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>

<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-14/46350763.jpg" alt="enter image description here"></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/13/MySQL-触发器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/13/MySQL-触发器/" class="post-title-link" itemprop="url">MySQL-触发器</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-13 22:51:06" itemprop="dateCreated datePublished" datetime="2018-11-13T22:51:06+08:00">2018-11-13</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:38" itemprop="dateModified" datetime="2019-10-15T10:03:38+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库-MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">数据库 MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL-触发器"><a href="#MySQL-触发器" class="headerlink" title="MySQL-触发器"></a>MySQL-触发器</h1><h2 id="什么是触发器"><a href="#什么是触发器" class="headerlink" title="什么是触发器"></a>什么是触发器</h2><ul>
<li>触发器是一种<strong>特殊的存储过程</strong>，它在插入/删除或修改表中的数据时<strong>触发执行</strong>，它比数据库本身有着更精细和更复杂的数据约束力。</li>
</ul>
<h2 id="触发器的作用"><a href="#触发器的作用" class="headerlink" title="触发器的作用"></a>触发器的作用</h2><ul>
<li>用于实现完整性约束</li>
<li>通过触发器，用户可以实现MySQL数据库本身并不支持的一些特性，如对于传统CHECK约束的支持，物化视图，高级复制，审计等特性</li>
</ul>
<h2 id="触发器的特性"><a href="#触发器的特性" class="headerlink" title="触发器的特性"></a>触发器的特性</h2><ul>
<li>监视地点：一般就是某一张表</li>
<li>监视/触发事件：UPDATE/INSERT/DELETE</li>
<li>触发时间：AFTER/BEFORE</li>
</ul>
<h2 id="触发器的创建语法"><a href="#触发器的创建语法" class="headerlink" title="触发器的创建语法"></a>触发器的创建语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">[DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line"><span class="keyword">TRIGGER</span> trigger_name</span><br><span class="line">trigger_time trigger_event</span><br><span class="line"><span class="keyword">ON</span> tbl_name <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line">trigger_body</span><br><span class="line"></span><br><span class="line">trigger_time: &#123; <span class="keyword">BEFORE</span> | <span class="keyword">AFTER</span> &#125;</span><br><span class="line">trigger_event: &#123; <span class="keyword">INSERT</span> | <span class="keyword">UPDATE</span> | <span class="keyword">DELETE</span> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>触发程序是与表有关的数据库对象，当表上出现特定事件时将激活该对象。触发程序与tbl_name相关，tbl_name必须引用永久性表，不能将触发程序与TEMPORARY表或视图关联起来。</li>
<li>对于具有相同触发程序动作事件和时间的给定表，不能有两个触发程序。</li>
<li>trigger_body是当触发程序激活时执行的语句。可以使用BEGIN…END复合语句结构。</li>
<li>对于INSERT而言，新插入的行用NEW表示，行中的每一列值用NEW.col_name表示。</li>
<li>对于DELETE而言，欲删除的那一行用OLD表示，行中的每一列值用OLD.col_name表示。</li>
<li>对于UPDATE而言，修改前的行用OLD表示，修改后的行用NEW表示。</li>
</ul>
<h2 id="触发器的管理"><a href="#触发器的管理" class="headerlink" title="触发器的管理"></a>触发器的管理</h2><ul>
<li><p>查看所有触发器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TRIGGERS</span> [<span class="keyword">FROM</span> db_name] [like_or_where]</span><br></pre></td></tr></table></figure>
</li>
<li><p>MySQL中有一个information_schema.TRIGGERS表，存储所有库中的触发器，查看：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC information_schema.TRIGGERS</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除触发器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>]</span><br><span class="line">view_name [, view_name] ...</span><br><span class="line">[RESTRICT | <span class="keyword">CASCADE</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="触发器的使用示例"><a href="#触发器的使用示例" class="headerlink" title="触发器的使用示例"></a>触发器的使用示例</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> user_trg</span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span></span><br><span class="line"><span class="keyword">ON</span> user_info <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_salaries <span class="keyword">SELECT</span> new.id, new.user_name, <span class="number">0</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">//</span><br><span class="line">DELIMITER;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info <span class="keyword">SELECT</span> <span class="number">1</span>, <span class="string">'张三'</span>， <span class="string">'123456'</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/13/JS7x7L.png" alt="enter image description here"></p>
<h3 id="对于约束的支持"><a href="#对于约束的支持" class="headerlink" title="对于约束的支持"></a>对于约束的支持</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> userCash(<span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>, </span><br><span class="line">					   cash <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line">)<span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> <span class="keyword">CHARSET</span> = <span class="string">'UTF8'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> userCashErr_log (</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	old_cash <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	new_cash <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	user_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	<span class="built_in">time</span> DATETIME</span><br><span class="line">)<span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> <span class="keyword">CHARSET</span> = <span class="string">'UTF8'</span>;</span><br><span class="line"></span><br><span class="line">DELIMITER //</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> userCashUpdate_tgr </span><br><span class="line"><span class="keyword">BEFORE</span> <span class="keyword">UPDATE</span></span><br><span class="line"><span class="keyword">ON</span> userCash <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">IF</span> new.cash - old.cash &gt; <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> userCashErr_log <span class="keyword">SELECT</span> old.id, old.cash, new.cash, <span class="keyword">USER</span>(), <span class="keyword">NOW</span>();</span><br><span class="line">		<span class="keyword">SET</span> new.cash = old.cash;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">//</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> userCash <span class="keyword">SELECT</span> <span class="number">1</span>, <span class="number">10000</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> userCashErr_log;</span><br><span class="line"><span class="keyword">UPDATE</span> userCash <span class="keyword">SET</span> cash = cash - (<span class="number">-20</span>) <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> userCashErr_log;</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/13/JS7T9W.png" alt="enter image description here"></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/13/MySQL-视图/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/13/MySQL-视图/" class="post-title-link" itemprop="url">MySQL-视图</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-13 16:56:59" itemprop="dateCreated datePublished" datetime="2018-11-13T16:56:59+08:00">2018-11-13</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:37" itemprop="dateModified" datetime="2019-10-15T10:03:37+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库-MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">数据库 MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL-视图"><a href="#MySQL-视图" class="headerlink" title="MySQL-视图"></a>MySQL-视图</h1><h2 id="什么是视图"><a href="#什么是视图" class="headerlink" title="什么是视图"></a>什么是视图</h2><ul>
<li>视图是由查询结果形成的一张<strong>虚拟表</strong>，可以当作一张表使用，但与持久表(permanent table)不同的是，视图中的数据<strong>没有实际的物理存储</strong>。</li>
</ul>
<h2 id="视图的作用"><a href="#视图的作用" class="headerlink" title="视图的作用"></a>视图的作用</h2><ul>
<li>视图在一定程度上起到一个<strong>安全层</strong>的作用，可以进行<strong>权限控制</strong></li>
<li><strong>简化查询</strong>语句</li>
<li>对于某张很大的表，可以将其分为多个视图，从而<strong>加快查询</strong></li>
</ul>
<h2 id="视图的使用条件"><a href="#视图的使用条件" class="headerlink" title="视图的使用条件"></a>视图的使用条件</h2><ul>
<li>如果某个查询结果出现的非常频繁，就是要经常那这个查询结果来做<strong>子查询</strong>，使用视图会更加方便</li>
</ul>
<h2 id="视图的基本操作"><a href="#视图的基本操作" class="headerlink" title="视图的基本操作"></a>视图的基本操作</h2><ul>
<li><p><strong>创建视图</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">[<span class="keyword">OR</span> <span class="keyword">REPLACE</span>]</span><br><span class="line">[ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;]</span><br><span class="line">[DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">[<span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;]</span><br><span class="line"><span class="keyword">VIEW</span> view_name [(column_list)]</span><br><span class="line"><span class="keyword">AS</span> select_statement</span><br><span class="line">[<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_name</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>调取视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> view_name</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span></span><br><span class="line">[ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;]</span><br><span class="line">[DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">[<span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;]</span><br><span class="line"><span class="keyword">VIEW</span> view_name [(column_list)]</span><br><span class="line"><span class="keyword">AS</span> select_statement</span><br><span class="line">[<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span> | <span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_name</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> view_name</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看视图的定义</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> <span class="keyword">STATUS</span> <span class="keyword">FROM</span> table_name <span class="keyword">LIKE</span> <span class="string">'view_name'</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="视图的算法–存在两种执行的算法"><a href="#视图的算法–存在两种执行的算法" class="headerlink" title="视图的算法–存在两种执行的算法"></a>视图的算法–存在两种执行的算法</h2><ul>
<li>MERGE：<strong>合并模式</strong>，先将我们视图的SQL语句与外部查询视图的SQL语句，混合在一起，最终执行，也就是可以<strong>更新</strong>真实表中的数据。</li>
<li>TEMPTABLE：<strong>临时表模式</strong>，每当查询的时候，将视图所使用的SELECT语句生成一个结果的临时表，再在当前的临时表内进行查询。</li>
<li>UNDEFINED： 让MySQL选择所要使用的算法。如果可能，它<strong>倾向于MERGE</strong>而不是TEMPTABLE，这是因为MERGE通常更有效，而且如果使用了临时表，视图是不可更新。</li>
</ul>
<h2 id="视图与表的关系"><a href="#视图与表的关系" class="headerlink" title="视图与表的关系"></a>视图与表的关系</h2><ul>
<li>虽然视图是基于表的一个虚拟表，但是用户可以对某些视图进行更新操作，其本质就是通过视图的定义来更新基表。一般称进行更新操作的视图为可更新视图(updatable view)。视图定义中的<strong>WITH CHECK OPTION</strong>就是针对于可更新表的。</li>
</ul>
<h2 id="WITH-CHECK-OPTION测试代码"><a href="#WITH-CHECK-OPTION测试代码" class="headerlink" title="WITH CHECK OPTION测试代码"></a>WITH CHECK OPTION测试代码</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建视图（WITHOUT CHECK OPTION）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> user_info_v <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> &lt; <span class="number">10</span></span><br><span class="line"><span class="comment"># 查看视图（基表 + 视图）</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span></span><br><span class="line"><span class="comment"># 只查看基表</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> table_type = <span class="string">'BASE TABLE'</span> <span class="keyword">AND</span> table_schema = <span class="keyword">database</span>()\G</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info_v <span class="keyword">SELECT</span> <span class="number">12</span>, <span class="string">'lisi'</span>, <span class="string">'5678'</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info_v <span class="keyword">SELECT</span> <span class="number">2</span>, <span class="string">'wangwu'</span>, <span class="string">'9012'</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info_v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除视图</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> user_info_v;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建视图（WITH CHECK OPTION）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> user_info_v <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> &lt; <span class="number">10</span> <span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info_v <span class="keyword">SELECT</span> <span class="number">13</span>, <span class="string">'zhaoliu'</span>, <span class="string">'3456'</span></span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/13/JSO1Dr.png" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/37805165.jpg" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/67280010.jpg" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/47500056.jpg" alt="enter image description here"></p>
<h2 id="视图的作用测试代码"><a href="#视图的作用测试代码" class="headerlink" title="视图的作用测试代码"></a>视图的作用测试代码</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER //</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> view_test(_cnt <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> @cnt = <span class="number">0</span>;</span><br><span class="line">	WHILE @cnt &lt; _cnt DO</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_info(user_name, user_pwd) <span class="keyword">values</span>(<span class="keyword">REPEAT</span>(<span class="built_in">CHAR</span>(<span class="number">97</span>+<span class="keyword">RAND</span>()*<span class="number">26</span>), <span class="number">20</span>), <span class="keyword">REPEAT</span>(<span class="built_in">CHAR</span>(<span class="number">97</span>+<span class="keyword">RAND</span>()*<span class="number">26</span>), <span class="number">20</span>));</span><br><span class="line">		<span class="keyword">SET</span> @cnt = @cnt + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">//</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> view_test(<span class="number">10000</span>);</span><br><span class="line"><span class="keyword">call</span> view_test(<span class="number">50000</span>);</span><br><span class="line"><span class="keyword">call</span> view_test(<span class="number">50000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_func_test0 <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> % <span class="number">4</span> = <span class="number">0</span> <span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_func_test1 <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> % <span class="number">4</span> = <span class="number">1</span> <span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_func_test2 <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> % <span class="number">4</span> = <span class="number">2</span> <span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_func_test3 <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="keyword">id</span> % <span class="number">4</span> = <span class="number">3</span> <span class="keyword">WITH</span> <span class="keyword">CHECK</span> <span class="keyword">OPTION</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://t1.picb.cc/uploads/2018/11/13/JSWxYv.png" alt="enter image description here"></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/13/python-urllib库的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/13/python-urllib库的使用/" class="post-title-link" itemprop="url">python-urllib库的使用</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-13 12:14:43" itemprop="dateCreated datePublished" datetime="2018-11-13T12:14:43+08:00">2018-11-13</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:38" itemprop="dateModified" datetime="2019-10-15T10:03:38+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python-lib/" itemprop="url" rel="index">
                    <span itemprop="name">Python lib</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Python-urllib库的介绍及使用"><a href="#Python-urllib库的介绍及使用" class="headerlink" title="Python urllib库的介绍及使用"></a>Python urllib库的介绍及使用</h1><p>@(python)[urllib]</p>
<p><strong>urllib</strong>库，是 Python 内置的 HTTP 请求库 ，也就是说不需要额外安装即可使用。它包含如下 4 个模块：</p>
<ul>
<li><strong>request</strong> ：最基本的 HTTP 请求模块，可以用来模拟发送请求 。 就像在浏览器里输入网址然后回车一样，只需要给库方法传入 URL 以及额外的参数，就可以模拟实现这个过程；</li>
<li><strong>error</strong> ：异常处理模块，如果出现请求错误 ， 我们可以捕获这些异常，然后进行重试或其他操作以保证程序不会意外终止；</li>
<li><strong>parse</strong> ：一个工具模块，提供了许多 URL 处理方法，比如拆分、解析 、 合并等。</li>
<li><strong>robotparse</strong>：主要是用来识别网站的 robots.txt 文件，然后判断哪些网站可以爬，哪些网站不可以爬，它其实用得比较少；</li>
</ul>
<p>接下来主要介绍前三个模块：<strong>request</strong>/<strong>error</strong>/<strong>parse</strong></p>
<hr>
<p>[TOC]</p>
<h2 id="request–基本请求模块"><a href="#request–基本请求模块" class="headerlink" title="request–基本请求模块"></a>request–基本请求模块</h2><p>使用 urllib 的 request 模块 ，我们可以方便地实现请求的发送并得到响应 。 本节就来看下它的具用法。 </p>
<h3 id="1-urlopen"><a href="#1-urlopen" class="headerlink" title="1. urlopen"></a>1. urlopen</h3><h4 id="urlopen-API"><a href="#urlopen-API" class="headerlink" title="urlopen API"></a>urlopen API</h4><p>urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</p>
<h5 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h5><ul>
<li>url: 具体请求的url</li>
<li>data：data参数是可选的。如果要添加该参数，并且如果它是字节流编码格式的内容，即bytes类型，则需要通过bytes()方法转化。另外，如果传递了这个参数，则它的请求方式就不再是GET方式，而POST方式。</li>
<li>timeout：timeout参数用于设置超时时间，单位为秒，如果请求超出了设置的这个时间，还没有得到响应，就会抛出异常。如果不指定该参数，就会使用全局默认时间。它支持HTTP/HTTPS/FTP请求。可以通过设置这个超时时间来控制一个网页如果长时间未响应，就跳过它的抓取 (利用 try - except 语句来实现 )</li>
<li>cafile：指定CA证书</li>
<li>capath：指定CA证书路径</li>
<li>cadefault：弃用，默认为false</li>
<li>context：必须是ssl.SSLContext类型，用来指定SSL设置</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urlon测试代码</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf8'</span>))</span><br><span class="line">print(response.status) <span class="comment"># 输出响应状态</span></span><br><span class="line">print(response.getheaders()) <span class="comment"># 输出响应头信息</span></span><br><span class="line">print(response.getheader(<span class="string">'Server'</span>)) <span class="comment"># 输出某响应头一个具体信息，如Server</span></span><br><span class="line"><span class="comment"># data参数测试</span></span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;<span class="string">'word'</span>: <span class="string">'hello'</span>&#125;), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/post'</span>, data = data)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment"># timeout参数测试</span></span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.baidu.com'</span>, timeout=<span class="number">0.01</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf8'</span>))</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://www.baidu.com'</span>, timeout=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason, socket.timeout):</span><br><span class="line">        print(<span class="string">'timeout'</span>)</span><br></pre></td></tr></table></figure>

<p><strong>输出：</strong><br><strong>获取网页源码/响应状态</strong><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/34725331.jpg" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/72483819.jpg" alt="enter image description here"><br><strong>data参数测试</strong><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/23750983.jpg" alt="enter image description here"><br><strong>timeout参数测试</strong><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/85235094.jpg" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/67726795.jpg" alt="enter image description here"></p>
<h3 id="2-Requset"><a href="#2-Requset" class="headerlink" title="2.Requset"></a>2.Requset</h3><p>我们知道利用 urlopen()方法可以实现最基本请求的发起，但这几个简单的参数并不足以构建一个完整的请求 。 如果请求中需要加入 Headers 等信息，就可以利用更强大的 Request 类来构建</p>
<h4 id="Request-API"><a href="#Request-API" class="headerlink" title="Request API"></a>Request API</h4><ul>
<li>urllib. request. Request (ur1, data=None, headers={}, origin_req_host=None,unverifiable=False, method=None)<h4 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h4></li>
<li><strong>url</strong>：待请求的url</li>
<li><strong>data</strong>：data参数是可选的。如果要添加该参数，并且如果它是字节流编码格式的内容，即bytes类型，则需要通过bytes()方法转化。另外，如果传递了这个参数，则它的请求方式就不再是GET方式，而POST方式。</li>
<li><strong>headers</strong>：一个字典，它就是请求头，我们可以在构造请求时通过headers参数直接构造，也可通过调用请求实例的add_header()法添加。添加请求头最常用的用法就是通过修改User-Agent来伪装浏览器，默认的User-Agent是Python-urllib，我们可通过修改它来伪装浏览器 。比如要伪装火狐浏览器，可以把它设置为：Mozilla/s.o (X11; U; Linux i686)  Gecko/20071127 Firefox/2.0.0.11</li>
<li><strong>origin_req_host:</strong> 指请求方的 host 名称或者 IP 地址。</li>
<li><strong>unversiable</strong>：表示这个请求是否是无法验证的，默认是 False ，意思就是说用户没有足够权限来选择接收这个请求的结果。 例如，我们请求一个 HTML 文档中的图片，但是我们没有向动抓取图像的权限，这时 unverifiable 的值就是 True 。</li>
<li><strong>method</strong>：指示请求使用的方法，比如 GET 、 POST 和 PUT 等。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Requset测试代码</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span>,</span><br><span class="line">           <span class="string">'Host'</span>: <span class="string">'httpbin.org'</span>&#125;</span><br><span class="line">dict = &#123;<span class="string">'name'</span>: <span class="string">'Germey'</span>&#125;</span><br><span class="line">data = bytes(urllib.parse.urlencode(dict), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">req = urllib.request.Request(url = url, data = data, headers = headers, method = <span class="string">'POST'</span>)</span><br><span class="line">response = urllib.request.urlopen(req)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>Request测试</strong><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/20751370.jpg" alt="enter image description here"></p>
<h3 id="3-高级用法"><a href="#3-高级用法" class="headerlink" title="3.高级用法"></a>3.高级用法</h3><p>在上面的过程中，我们虽然可以构造请求，但是对于一些更高级的操作（比如 Cookies 处理 、 代理设置等），我们该怎么办呢？接下来，就需要更强大的工具 Handler 登场了 。 简而言之，我们可以把它理解为各种处理器，有专门处理登录验证的，有处理 Cookies 的，有处理代理设置的 。利用它们，我们几乎可以做到 HTTP请求中所有的事情。<br>首先，介绍一下 urllib.request模块里的 BaseHandler 类，它是所有其他 Handler 的父类，它提<br>供了最基本的方法，例如 default_open()、 protocol_request ()等<br>接下来，就有各种 Ha ndler 子类继承这个 BaseHandler 类，举例如下：</p>
<ul>
<li><strong>HTTPDefaultErrorHandler</strong>：用于处理HTTP响应错误，错误都会抛出 HTTP Error 类型的异常 </li>
<li><strong>HTTPRedirectHandler</strong> ： 用于处理重定向 </li>
<li><strong>HTTPCookieProcessor</strong> ：用于处理 Cookies </li>
<li><strong>ProxyHandler</strong> ：用于设置代理 ， 默认代理为空 </li>
<li><strong>HTTPPasswordMgr</strong> ：用于管理密码，它维护了用户名和密码的表 </li>
<li><strong>HTTPBasicAuthHandler</strong> ：用于管理认证，如果一个链接打开时需要认证，那么可以用它来解决认证问题</li>
</ul>
<p>另一个比较重要的类就是 <strong>OpenerDirector</strong> ，我们可以称为 <strong>Opener</strong> 。 我们之前用过 urlopen()个方法，实际上它就是 urllib 为我们提供的一个 Opener。之前使用的 Request 和 urlopen()相当于类库为你封装好了极其常用的请求方法，利用它们可以完成基本的请求，但是现在不一样了，我们需要实现更高级的功能，所以需要深入一层进行配置，使用更底层的实例来完成操作，所以这里就用到了 Opener 。Opener 可以使用 open()法，返回的类型和 urlopen()如出一辙 。 那么，它和 Handler 有什么关系呢？简而言之，就是<strong>利用 Handler 来构建 Opener</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 高级用法测试代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证测试</span></span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> HTTPPasswordMgrWithDefaultRealm, HTTPBasicAuthHandler, build_opener</span><br><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"></span><br><span class="line">username = <span class="string">'username'</span></span><br><span class="line">password = <span class="string">'password'</span></span><br><span class="line">url = <span class="string">'http://localhost:5000/'</span></span><br><span class="line">p = HTTPPasswordMgrWithDefaultRealm()</span><br><span class="line">p.add_password(<span class="literal">None</span>, url, username, password)</span><br><span class="line">auth_handler = HTTPBasicAuthHandler(p)</span><br><span class="line">opener = build_opener(auth_handler)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = opener.open(url)</span><br><span class="line">    html = result.read().decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    print(html)</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理测试</span></span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy_handler = ProxyHandler(&#123;<span class="string">'http'</span>: <span class="string">'http://127.0.0.1:9743'</span>,</span><br><span class="line">                              <span class="string">'https'</span>: <span class="string">'https://127.0.0.1:9743'</span>&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = opener.open(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br><span class="line"></span><br><span class="line"><span class="comment"># cookies测试</span></span><br><span class="line"><span class="keyword">import</span> http.cookiejar, urllib.request</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.CookieJar()</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookie:</span><br><span class="line">    print(item.name + <span class="string">'='</span> + item.value)</span><br></pre></td></tr></table></figure>

<h2 id="error–异常处理"><a href="#error–异常处理" class="headerlink" title="error–异常处理"></a>error–异常处理</h2><p>urllib 的 error 模块定义了由 req u est 模块产生的异常，如果出现了问题， request 模块便会抛出error 模块中定义的异常</p>
<ul>
<li>URLError<br>URLError类来自 urllib 库的 error 模块，它继承自 OS Error 类，是 error 异常模块的基类，由request模块生的异常都可以通过捕获这个类来处理。它具有一个reason属性，即返回错误的原因。</li>
<li>HTTPError<br>它是URLError的子类，专门用来处理HTTP请求错误，比如请求失败等。它具有以下三个属性：<br>code：返回HTTP状态码-404/200等<br>reason：返回错误信息<br>headers：返回请求头<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URLError测试代码</span></span><br><span class="line">print(<span class="string">'URLError test:'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://hellomrrs.top:8086'</span>)</span><br><span class="line">    print(response.status)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://hellomrrs.top:8086/111.html'</span>)</span><br><span class="line">    print(response.status)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPError测试代码</span></span><br><span class="line">print(<span class="string">'HTTPError test:'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://hellomrrs.top:8086/111.html'</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason, e.code, e.headers, sep=<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 较好的异常处理机制</span></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http:hellomrrs.top:8086/111.html'</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason, e.code, e.headers, sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/26601279.jpg" alt="enter image description here"></p>
<h2 id="parse–解析链接"><a href="#parse–解析链接" class="headerlink" title="parse–解析链接"></a>parse–解析链接</h2><p>urllib库里还提供了parse模块，它定义了处理URL的标准接口，例如实现URL各部分的抽取、合并以及链接转换。它支持如下协议的 URL 处理：file、ftp、 gopher、hdl、http、 https、imap 等。下面简单介绍一下常用的接口。</p>
<p>观察以下URL: <a href="http://www.baidu.com/index/html;user?id=5#comment，urlparse可将其划分为6个部分：*://--*/--*;--*?--*#--*，即http://--www.baidu.com--index.html--user--id=5--comment，这六个部分分别称为：**scheme(协议)**--**netaloc(域名)**--**path(访问路径)**--**params(参数)**--**query(查询条件)**--**fragment(锚点-用来直接定位页面内部的下拉位置)**。所以，可以得出一个标准的链接格式：" target="_blank" rel="noopener">http://www.baidu.com/index/html;user?id=5#comment，urlparse可将其划分为6个部分：*://--*/--*;--*?--*#--*，即http://--www.baidu.com--index.html--user--id=5--comment，这六个部分分别称为：**scheme(协议)**--**netaloc(域名)**--**path(访问路径)**--**params(参数)**--**query(查询条件)**--**fragment(锚点-用来直接定位页面内部的下拉位置)**。所以，可以得出一个标准的链接格式：</a><br><strong>scheme://netaloc/path;params?query#fragment</strong></p>
<ul>
<li>urlparse(urlstring, scheme=”, allow_fragments=True)：该方法可以实现URL的识别和分段<ul>
<li><strong>urlstring</strong>：待解析的URL</li>
<li><strong>scheme</strong>：URL的协议类型，只有在urlstring中没有包含协议类型时才起作用</li>
<li><strong>allow_fragments</strong>：是否忽略fragme，如果它被设置为False，fragment 部分就会被忽略，它会被解析为 path 、 parameters 或者 query 的一部分，而 fragment 部分为空。</li>
</ul>
</li>
<li>urlunparse(parts)：它接受的是参数是一个可迭代对象，但它的长度必须是6</li>
<li>urlsplit(urlstring, scheme=’’, allow_fragments=True)：该方法和urlparse方法十分相似，只不过它不再单独解析params这一部分，只返回5个结果。</li>
<li>urlunsplit(parts)：与 urlunparse类似，它也是将链接各个部分组合成完整链接的方法，传入的参数也是一个可迭代对象，例如列表 、 元组等，唯一的区别是长度必须为 5。</li>
<li>urljoin(base, url, allow_fragments=True)：base_url提供了三项内容scheme 、 netloc 和 path 。 如果这 3 项在新的链接里不存在，就予以补充；如果新的链接存在，就使用新的链接的部分。而 base_url中的params、query和fragment是不起作用的，最后返回结果 。</li>
<li>urlencode(query, doseq=False, safe=’’, encoding=None, errors=None, quote_via=quote_plus)：在构造GET请求参数时非常有用</li>
<li>parse_qs(qs, keep_blank_values=False, strict_parsing=False)：反序列化，将一串GET参数转回字典</li>
<li>parse_qsl(qs, keep_blank_values=False, strict_parsing=False)：将参数转化为元组组成的列表</li>
<li>quote(str)：将内容转化为URL编码的格式。URL 中带有中文参数时，有时可能会导致乱码的问题，此时用这个方法可以将巾文字符转化为 URL 编码。</li>
<li>unquote(str)：对URL进行解码<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'urlparse测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">response = urlparse(<span class="string">'http://www.baidu.com/index.html;user?id=5#comment'</span>)</span><br><span class="line">print(type(response), response, sep=<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nurlunparse测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlunparse</span><br><span class="line"></span><br><span class="line">data = [<span class="string">'http'</span>, <span class="string">'www.baidu.com'</span>, <span class="string">'index.html'</span>, <span class="string">'user'</span>, <span class="string">'a=6'</span>, <span class="string">'comment'</span>]</span><br><span class="line">print(urlunparse(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nurlsplit测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlsplit</span><br><span class="line"></span><br><span class="line">response = urlsplit(<span class="string">'http://www.baidu.com/index.html;user?id=5#comment'</span>)</span><br><span class="line">print(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nurlunsplit测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlunsplit</span><br><span class="line"></span><br><span class="line">data = [<span class="string">'http'</span>, <span class="string">'www.baidu.com'</span>, <span class="string">'index.html'</span>, <span class="string">'a=6'</span>, <span class="string">'comment'</span>]</span><br><span class="line">print(urlunsplit(data))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nurljoin测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"></span><br><span class="line">print(urljoin(<span class="string">'http://www.baidu.com'</span>, <span class="string">'FAQ.html'</span>))</span><br><span class="line">print(urljoin(<span class="string">'http:'</span><span class="string">'www.baidu.com'</span>, <span class="string">'http://hellomrrs.top:8086/index.html'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nurlencode测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line"></span><br><span class="line">params = &#123;<span class="string">'name'</span>: <span class="string">'germey'</span>, <span class="string">'age'</span>: <span class="number">22</span>&#125;</span><br><span class="line">base_url = <span class="string">'http://www.baidu.com?'</span></span><br><span class="line">url = base_url + urlencode(params)</span><br><span class="line">print(url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nparse_qs测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qs</span><br><span class="line"></span><br><span class="line">query = <span class="string">'name=germey&amp;age=22'</span></span><br><span class="line">print(parse_qs(query))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nparse_qsl测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qsl</span><br><span class="line"></span><br><span class="line">query = <span class="string">'name=germey&amp;age=22'</span></span><br><span class="line">print(parse_qsl(query))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nquote测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">keyword = <span class="string">'壁纸'</span></span><br><span class="line">url = <span class="string">'http://www.baidu.com/s?wd='</span> + quote(keyword)</span><br><span class="line">print(url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'\nunquote测试'</span>)</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"></span><br><span class="line">print(unquote(<span class="string">'http://www.baidu.com/s?wd=%E5%A3%81%E7%BA%B8'</span>))</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/32306346.jpg" alt="enter image description here"><br><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/78219128.jpg" alt="enter image description here"></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/12/MySQL高级-函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/12/MySQL高级-函数/" class="post-title-link" itemprop="url">MySQL高级-函数</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-12 20:12:37" itemprop="dateCreated datePublished" datetime="2018-11-12T20:12:37+08:00">2018-11-12</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:37" itemprop="dateModified" datetime="2019-10-15T10:03:37+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库-MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">数据库 MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL高级-函数"><a href="#MySQL高级-函数" class="headerlink" title="MySQL高级-函数"></a>MySQL高级-函数</h1><p>@(mysql)[procedure]</p>
<h2 id="查看数据库是否支持函数-："><a href="#查看数据库是否支持函数-：" class="headerlink" title="查看数据库是否支持函数 ："></a><strong>查看数据库是否支持函数</strong> ：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%FUN%'</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>若为off，则需要开启</strong><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_bin_trust_function_creators = <span class="literal">TRUE</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="创建函数的语法-："><a href="#创建函数的语法-：" class="headerlink" title="创建函数的语法 ："></a><strong>创建函数的语法</strong> ：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> func_name(variable1, variable2 ...)</span><br><span class="line"><span class="keyword">RETURNS</span> return_type</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	...</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line">DELIMITER //</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> func_add(a <span class="built_in">INT</span>, b <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">RETURN</span> a + b;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">//</span><br></pre></td></tr></table></figure>

<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-12/68702030.jpg" alt="enter image description here"></p>
<h2 id="函数的管理-："><a href="#函数的管理-：" class="headerlink" title="函数的管理 ："></a><strong>函数的管理</strong> ：</h2><ul>
<li><strong>函数的管理类似于存储过程</strong><h3 id="查看函数"><a href="#查看函数" class="headerlink" title="查看函数"></a><strong>查看函数</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mysql.proc;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> <span class="keyword">STATUS</span> <span class="keyword">WHERE</span> db = <span class="string">'test'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-12/68702030.jpg" alt="enter image description here"></p>
<h3 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a><strong>删除函数</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> func_add;</span><br></pre></td></tr></table></figure>

<h2 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h2><pre><code class="SQL"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_info (<span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,
                        user_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,
                        user_pwd  <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>
                        )<span class="keyword">ENGINE</span> = <span class="keyword">INNODB</span> <span class="keyword">CHARSET</span> = utf8;

<span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> func_login(<span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>), pwd <span class="built_in">VARCHAR</span>(<span class="number">20</span>))
<span class="keyword">RETURNS</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>)
<span class="keyword">BEGIN</span>
    <span class="keyword">DECLARE</span> cnt <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;
    <span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">INTO</span> cnt <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> user_name = <span class="keyword">name</span>;
    IF cnt = 0 THEN
        RETURN 'user not exists';
    <span class="keyword">END</span> <span class="keyword">IF</span>;
    <span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">INTO</span> cnt <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> user_name = <span class="keyword">name</span> <span class="keyword">AND</span> user_pwd = pwd;
    IF cnt = 0 THEN
        RETURN 'pwd input error';
    ELSE
        RETURN 'user login success';
    <span class="keyword">END</span> <span class="keyword">IF</span>;
<span class="keyword">END</span>;
//</code></pre>
<p><img src="http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-12/35546849.jpg" alt="enter image description here"></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mrrs878.github.io/2018/11/12/MySQL高级-存储过程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.RS">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/imgs/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.RS">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            
            <a href="/2018/11/12/MySQL高级-存储过程管理/" class="post-title-link" itemprop="url">MySQL高级-存储过程管理</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2018-11-12 17:07:28" itemprop="dateCreated datePublished" datetime="2018-11-12T17:07:28+08:00">2018-11-12</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-15 10:03:37" itemprop="dateModified" datetime="2019-10-15T10:03:37+08:00">2019-10-15</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库-MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">数据库 MySQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL高级-存储过程管理"><a href="#MySQL高级-存储过程管理" class="headerlink" title="MySQL高级-存储过程管理"></a>MySQL高级-存储过程管理</h1><p>@(mysql)[procedure]</p>
<ul>
<li><p><strong>查看数据库的存储过程</strong> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">procedure</span> <span class="keyword">status</span> <span class="keyword">where</span> db=<span class="string">'test'</span>\G</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="https://i.loli.net/2018/11/12/5be94f5043e82.png" alt="enter image description here"></p>
</li>
<li><p><strong>查看当前数据库下的存储过程</strong> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> specific_name <span class="keyword">from</span> mysql.proc;\G</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="https://i.loli.net/2018/11/12/5be94ee471819.png" alt="enter image description here"></p>
</li>
<li><p><strong>查看存储过程的内容</strong> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> specific_name, <span class="keyword">body</span> <span class="keyword">from</span> mysql.proc\G</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="https://i.loli.net/2018/11/12/5be94f5050259.png" alt="enter image description here"></p>
</li>
<li><p><strong>查看某个存储过程的内容</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> specific_name, <span class="keyword">body</span> <span class="keyword">from</span> mysql.proc <span class="keyword">where</span> specific_name = <span class="string">'load_t'</span>\G</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="https://i.loli.net/2018/11/12/5be94f504e883.png" alt="enter image description here"></p>
</li>
<li><p><strong>删除某个存储过程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> <span class="keyword">if</span> <span class="keyword">exists</span> load_t;</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="https://i.loli.net/2018/11/12/5be94f504cd4b.png" alt="enter image description here"></p>
</li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

    
  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/imgs/avatar.png"
      alt="Mr.RS">
  <p class="site-author-name" itemprop="name">Mr.RS</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.RS</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">
      
    主题 – <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.1
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/pisces.js?v=7.4.1"></script>
<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

</body>
</html>
